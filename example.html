<link href="kanbun.css" rel="stylesheet" />
<script src="kanbun.js"></script>

<style>
  body > div {
    margin: 0 auto 1.5em;
    width: 840px;
    max-width: 100%;
    min-height: 1em;
  }
  body > div button:first-of-type {
    margin-left: 0;
    margin-right: 2em;
  }
  textarea {
    width: 100%;
    font-size: 1rem;
    padding: 5px;
  }
  label {
    display: block;
    margin: 0 0 0.5em 1.5em;
    width: fit-content;
  }
  label.radio {
    float: left;
    margin-right: 2em;
}
  label input {
    width: 1em;
    margin: 0 0.5em 0 -1.5em;
  }
</style>

<div>This is a 漢文訓読<sub><em>kanbun-kundoku</em></sub> HTML display solution (maybe the best solution) supporting both アキ組<sub><em>akigumi</em></sub> and ベタ組<sub><em>betagumi</em></sub> typesetting. It converts annotated kanbun text to HTML and displays it.</div>
<div>
  <textarea rows="10" id="kanbun-text"></textarea>
</div>
<div>
  <button type="button" onclick="convert()">Convert!</button>Insert:
  <button type="button" onclick="insertPair('‹', '›');">再読文字振り仮名</button>
  <button type="button" onclick="insertPair('«', '»')">再読文字送り仮名</button>
  <button type="button" onclick="insert('―')">たて点 ―</button>
  <button type="button" onclick="insert('〻')">二の字点〻</button>
</div>
<div>
  <div class="kanbun okurigana-sinking split-touching-kana" id="sample"></div>
</div>
<div>
  <label class="radio">
    <input type="radio" name="betagumi" onclick="check(this, false)" autocomplete="off" checked="checked"
    />アキ組<sub><em>akigumi</em></sub>
  </label>
  <label class="radio">
    <input type="radio" name="betagumi" onclick="check(this, true)" autocomplete="off"
    />ベタ組<sub><em>betagumi</em></sub>
  </label>
</div>
<div>
  <label>
    <input type="checkbox" name="kanbun" onclick="check(this)" autocomplete="off" checked="checked"
    />Use kanbun style
  </label>
  <label>
    <input type="checkbox" name="okurigana-sinking" onclick="check(this)" autocomplete="off" checked="checked"
    />Make 送り仮名<sub><em>okurigana</em></sub> sink 1/4 kanji-height when without 振り仮名<sub><em>furigana</em></sub>
  </label>
  <label>
    <input type="checkbox" name="split-touching-kana" onclick="check(this)" autocomplete="off" checked="checked"
    />Split adjacent kana of different kanji if they touch with each other (effective only under ベタ組<sub><em>betagumi</em></sub>)
  </label>
  <label>
    <input type="checkbox" name="furigana-center-align" onclick="check(this)" autocomplete="off"
    />Align 振り仮名<sub><em>furigana</em></sub> to the center of kanji when without 送り仮名<sub><em>okurigana</em></sub> (effective only under ベタ組<sub><em>betagumi</em></sub>)
  </label>
  <label>
    <input type="checkbox" name="show-borders" onclick="check(this)" autocomplete="off"
    />Show borders of elements (for debugging)
  </label>
</div>
<div>
  <a href="https://github.com/untunt/kanbunHTML">Check out kanbunHTML on GitHub</a>
</div>

<script>
  const textarea = document.getElementById("kanbun-text");
  const sample = document.getElementById("sample");
  function convert() {
    sample.innerHTML = "<p>" + textarea.value.replace(/\n/g, "</p><p>") + "</p>";
    convertKanbunDiv(sample);
  }
  function insertPair(left, right) {
    let s = textarea.value;
    let l = textarea.selectionStart;
    let r = textarea.selectionEnd;
    console.log(s.substr(0, l));
    console.log(s.substr(l, r));
    console.log(s.substr(r));
    textarea.value = s.substr(0, l) + left + s.substr(l, r - l) + right + s.substr(r);
    textarea.selectionStart = r + left.length + right.length;
    textarea.selectionEnd = textarea.selectionStart;
    textarea.focus();
  }
  function insert(str) { insertPair('', str); }
  function check(box, v = box.checked) { sample.classList[v ? "add" : "remove"](box.name); }
  textarea.value = [
    "感ジテハ[レ]時ニ花ニモ濺(そそ)ギ[レ]淚ヲ，恨ミデハ[レ]別レヲ鳥ニモ驚カス[レ]心ヲ。",
    "使メバ[人]籍(せき)ヲシテ誠ニ不[乙]以テ[下]畜(やしな)ヒ[二]妻子ヲ[一]，憂フルヲ[中]饑(き)寒(かん)ヲ[上]亂サ[甲レ]心ヲ，有リテ[二]錢財[一]以(もつ)テ濟(な)サ[地]醫藥ヲ[天]…",
    "子曰ク，盍ゾ«ル»[三]各〻言ハ[二]爾ノ志ヲ[一]。",
    "孤之有ルハ[二]孔明[一]，猶ホ‹ごと›«キ»[二]魚之有ルガ[一レ]水也。",
    "此レ乃チ信(しん)ノ之‘所―[三]以’(ゆゑん)為ル[二]陛下ノ禽(とりこ)ト[一]也。",
  ].join('\n')
  convert();
</script>
